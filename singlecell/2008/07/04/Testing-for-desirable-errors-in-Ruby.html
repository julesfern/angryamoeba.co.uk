<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">

	
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Language" content="en-us" />
		
		<title>Testing for desirable errors in Ruby</title>
		
		<meta name="ROBOTS" content="ALL" />
		<meta http-equiv="imagetoolbar" content="no" />
		<meta name="MSSmartTagsPreventParsing" content="true" />
		<meta name="Copyright" content="(c) 2005 Copyright content: Angry amoeba Copyright design: Angry amoeba" />
		<!-- (c) Copyright 2005 by Angryamoeba All Rights Reserved. -->
		
		<meta name="Keywords" content="angryamoeba, amoeba, dan, glegg, danski, daniel, applications, CSS, XHTML, javascript,
												 PHP, HTML, MySQL, SQL, ruby, rails, actionscript, action, script, flash, OOP, 
												 development, developer, uk, sussex, england, great, britain, programmer, programming,
												 blogger, podcast, blog, useful, software, W3C, standards, bish, bash, bosh" />
		<meta name="Description" content="A blog about technology, business, products, web standards and the open web." />
		

		<!-- Presentation -->
		<link rel="stylesheet" href="/stylesheets/angryamoeba-core.css" type="text/css" media="all" charset="utf-8" />
		<link rel="stylesheet" href="/stylesheets/angryamoeba-blog.css" type="text/css" media="all" charset="utf-8" />
		<link rel="stylesheet" href="/stylesheets/angryamoeba-docs.css" type="text/css" media="all" charset="utf-8" />
		
		<!-- Interactivity -->
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.0/jquery.min.js"></script>
		<script type="text/javascript" src="/lib/angryamoeba/angryamoeba-core.js"></script>
		<script type="text/javascript" src="/lib/angryamoeba/angryamoeba-blog.js"></script>
</head>
	
	<body>		
			<div id="network" class="section">
		<ol class="sub navigation">
			<li><h1><a href="/" class="home"><img src="/images/brand/amoeba-text-small.png" alt="Dan Glegg, Angry amoeba" /></a></h1></li>
			<li><a href="/singlecell/" class="blog">Singlecell Blog</a></li>
			<li><a href="/about.html" class="about">About</a></li>
		</ol>
</div>			

			
<div id="focus" class="section forty-sixty">

			<h1 class="left">
				<a href="/singlecell/2008/07/04/Testing-for-desirable-errors-in-Ruby.html">Testing for desirable errors in Ruby</a>
				<span class="date">04 Jul, 2008</span>
			</h1>
			
			<div class="right box">
				 

<p>Sometimes, you <em>want</em> your code to fail. You want to make sure that in the event of a failure, an exception is generated - the equivalent of a controlled explosion. Something you can design contingencies around. Until now I&#8217;ve been a little frustrated with testing these eventualities, so I decided to hack up a quick custom assertion for your Test::Unit suites (although it should translate pretty effortlessly to RSpec or any other test framework):</p>

<div class="highlight"><pre><span class="c1"># In test_helper.rb:</span>
<span class="k">def</span> <span class="nf">assert_error_raised</span><span class="p">(</span><span class="n">errorklass</span><span class="o">=</span><span class="no">StandardError</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">block</span><span class="p">)</span>
     <span class="n">raised</span> <span class="o">=</span> <span class="kp">false</span>
     <span class="k">begin</span>
       <span class="n">block</span><span class="o">.</span><span class="n">call</span> 
     <span class="k">rescue</span> <span class="n">errorklass</span> 
       <span class="n">raised</span> <span class="o">=</span> <span class="kp">true</span>
     <span class="k">end</span>
     <span class="c1"># You will see this message if an error was not raised.</span>
     <span class="c1"># If an error was raised which was not of the type you specified, then the test trace</span>
     <span class="c1"># will be allowed to display the error as normal and the test will fail with an E.</span>
     <span class="n">assert</span> <span class="n">raised</span><span class="p">,</span> <span class="s2">&quot;Expected error </span><span class="si">#{</span><span class="n">errorklass</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2"> to be raised but error never encountered.&quot;</span>
<span class="k">end</span>

<span class="c1"># In your application code, let&#39;s say some_model.rb:</span>
<span class="k">def</span> <span class="nf">do_something_with</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
       <span class="k">unless</span> <span class="n">array</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="nb">Array</span><span class="p">)</span>
              <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">&quot;Argument of type </span><span class="si">#{</span><span class="n">array</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2"> given to SomeModel#do_something when argument must be of type Array&quot;</span>
       <span class="k">end</span>
       <span class="n">continue_doing_something</span>
<span class="k">end</span>

<span class="c1"># In your test suite:</span>
<span class="k">def</span> <span class="nf">test_error_generated_with_bad_argument_to_do_something_with</span>
       <span class="vi">@some_model</span> <span class="o">=</span> <span class="no">SomeModel</span><span class="o">.</span><span class="n">new</span>
       <span class="c1"># This test will pass</span>
       <span class="n">assert_error_raised</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="k">do</span>
              <span class="vi">@some_model</span><span class="o">.</span><span class="n">do_something_with</span> <span class="s2">&quot;i&#39;m not an array&quot;</span>
       <span class="k">end</span>
       <span class="c1"># This test will fail and dump the error via your test console&#39;s usual channel</span>
       <span class="n">assert_error_raised</span><span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="k">do</span>
              <span class="vi">@some_model</span><span class="o">.</span><span class="n">do_something_with</span> <span class="s2">&quot;neither am i&quot;</span>
       <span class="k">end</span>
<span class="k">end</span>
</pre></div>
				<!-- vCard and bio -->
<div id="hcard-Dan-Glegg" class="vcard">
	 <img src="/images/icons/dan-portrait-small.jpg" alt="Photo of Dan speaking at an event" title="Image thanks to Richard Dallaway" class="photo"/>
	<p>
		<a class="url fn" href="http://www.angryamoeba.co.uk/singlecell/">Dan Glegg</a> is a software developer living and working in 
		<span class="adr"><span class="locality">Brighton</span>, <span class="country-name">United Kingdom</span></span>. 
		He works mainly with Ruby, Objective-C, Flex and W3C standards and spends most of his time 
		developing products, often with startup companies.
	</p>
	
	<ul>
		<li><a href="http://twitter.com/angryamoeba" class="url social twitter">Twitter</a></li>
		<li><a href="http://www.linkedin.com/in/angryamoeba" class="url social linkedin">LinkedIn</a></li>
		<li><a href="http://flickr.com/photos/angryamoeba/" class="url social flickr">Flickr</a></li>
		<li><a href="http://github.com/danski/" class="url social github">Github</a></li>
		<li><a href="http://delicious.com/danski" class="url social delicious">Del.icio.us</a></li>
	</ul>								

	<div class="tags">
		<a href="http://kitchen.technorati.com/contacts/tag/startup">startup</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/entrepreneur">entrepreneur</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/developer">developer</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/engineer">engineer</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/technology">technology</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/consultancy">consultancy</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/ruby">ruby</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/flex">flex</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/objective-c">objective-c</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/iphone">iphone</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/mac">mac</a> 
		<a href="http://kitchen.technorati.com/contacts/tag/w3c">w3c</a>
	</div>
</div>
			</div>
	
</div>

<div id="content" class="section forty-sixty">
	

	<div class="right box bright">
		<div id="disqus_thread"></div>
		<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a>		
	</div>

	
</div>			
			
			<div id="footer" class="section fifty-fifty">
	<span class="left copyright">
		Design and brand copyright &copy; <a href="/">Dan Glegg</a> 2009. 
		
		The <a href="http://www.videojuicer.com" rel="external">Videojuicer</a> and <a href="http://oauth.net/" rel="external">OAuth</a> marks
		are property of their respective owners.
		
		
		<span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" property="dc:title" rel="dc:type">
				The text content of all posts from Singlecell, the Angry amoeba weblog
		</span> by 
		<a xmlns:cc="http://creativecommons.org/ns#" href="http://www.angryamoeba.co.uk" property="cc:attributionName" rel="cc:attributionURL">Dan Glegg</a> 
				is licensed under a 
		<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/us/">Creative Commons Attribution-No Derivative Works 3.0 United States License</a>.
		<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/us/">
			<img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-nd/3.0/us/80x15.png" />
		</a>
	</span>
	<ol class="navigation right">
		<li><a href="/" class="home">Home</a></li>
		<li><a href="/singlecell/" class="blog" rel="external">Singlecell Blog</a></li>
		<li><a href="/about.html" class="about">About</a></li>
		<li><a href="http://validator.w3.org/check?uri=referer" rel="external">Validate HTML</a></li>
	</ol>				
</div>
			<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
	var pageTracker = _gat._getTracker("UA-1036922-2"); pageTracker._initData(); pageTracker._trackPageview();
</script>
	</body>
	
</html>
